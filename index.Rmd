---
title: "**POMA** <br> _<font style='font-size:28px'>An User-friendly Workflow for Pre-processing and Statistical Analysis of Mass Spectrometry Data</font>_" 
subtitle: "European _Bioconductor_ Meeting 2020"
author: "**Pol Castellano-Escuder**"
institute: "University of Barcelona"
date: "Dec 18, 2020"
output:
  xaringan::moon_reader:
    css: [default, metropolis, "mycss.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
# knit: pagedown::chrome_print
---

layout: true

<div class="my-header"><img src="img/logo.png" alt="logo" align="right" height="90%"></div>

<div class="my-footer"><span>
<a href="https://twitter.com/polcastellano_" style="color:white">@polcastellano_</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<!--&emsp;-->
#EuroBioc2020
</span></div>

```{r setup, include = FALSE}
stopifnot(require(htmltools))
stopifnot(require(knitr))
```

```{r htmltools, include = FALSE}
htmltools::tagList(rmarkdown::html_dependency_font_awesome())
```

---

# Outline

.columnwide[
  ### 1) Scope of the package
  ### 2) POMA workflow (with examples)
  ### &emsp; 2.1) Data formatting
  ### &emsp; 2.2) Pre-processing
  ### &emsp; 2.3) Exploratory Data Analysis (EDA)
  ### &emsp; 2.4) Statistical Analysis
  ### 3) Next steps...
]

.columnnarrow[
<img align = "left" src="https://eurobioc2020.bioconductor.org/images/hexsticker.png" height="200">
<br>
<img align = "right" src="https://images.squarespace-cdn.com/content/v1/5423875be4b03f0c482a58c4/1532953317705-W6TYTE70KG5E6KQEZU1K/ke17ZwdGBToddI8pDm48kNVP8RwsgCc7XlHc2zPQeqdZw-zPPgdn4jUwVcJE1ZvWQUxwkmyExglNqGp0IvTJZUJFbgE-7XRK3dMEBRBhUpxA5wn4368HhrDKfvXqORu9oTEmTJkjlQ2gdQcVngofpWQcE5w-MKnvigIPwIMqpXs/Bioconductor.png?format=750w" height="200">
]

---

# Scope of POMA

.center[
.textboxorange[`POMA` package focuses on <u>**statistical analysis**</u> of metabolomics and proteomics]
]

--

  1) Directly from sheet (xlsx, csv, etc.) &#10060;&#10060;
  
--
  
  2) Extracting quantitative data from `MSnbase::MSnSet` objects &#10060;

--

  3) Using `MSnbase::MSnSet` objects directly (++ reproducibility and interoperability) &#9989;

--

.center[
<img align = "center" src="img/figure1.png" width = "80%">
]

---

# POMA workflow: 1) Data formatting

.center[
.textboxorange[The input format required in all `POMA` functions in a `MSnbase::MSnSet` object]
]

.pull-left[

**Target or "_phenotype data_"**

<img align = "left" src="https://raw.github.com/pcastellanoescuder/POMAShiny/master/app/mds/pix/target.png" height="200">

]

.pull-right[

**Features or "_expression data_"**

<img align = "left" src="https://raw.github.com/pcastellanoescuder/POMAShiny/master/app/mds/pix/features.png" height="200">

]

<br>

```{r, eval = FALSE}
# create MSnSet object from target and features data frames
msnset_object <- PomaMSnSetClass(tatget = "target", features = "features")
```

---

# POMA workflow: 2) Pre-processing

.center[
.textboxorange[All `POMA` pre-processing methods return a pre-processed `MSnSet` object]
]

### 2.1) Missing value imputation

```{r, eval = FALSE}
msnset_object %>% 
  PomaImpute(ZerosAsNA = FALSE, # treat zeros as zeros instead of NAs
             RemoveNA = TRUE, cutoff = 20, # remove columns with >20% of NA
             method = "knn") # k-nearest neighbors (default)
```

--

### 2.2) Normalization

```{r, eval = FALSE}
msnset_object %>% 
  PomaNorm(method = "log_pareto") # log Pareto scaling (default)
```

---

# POMA workflow: 2) Pre-processing

### 2.3) Outlier detection and cleaning

.pull-left[

Detection:

```{r, eval = FALSE}
msnset_object %>% 
  {{PomaOutliers(do = "analyze")}}
```

Output:

```{r, echo = FALSE, cache = TRUE, warning = FALSE, comment = FALSE, message = FALSE, fig.height = 4}
library(POMA)
library(patchwork)
library(ggplot2)

poma_outliers <- st000284 %>% 
  PomaNorm() %>%
  PomaOutliers(do = "analyze")

poma_outliers$polygon_plot + theme(legend.position = "top") | poma_outliers$distance_boxplot + theme(legend.position = "top")
```

]

.pull-right[

Clean:

```{r, eval = FALSE}
msnset_object %>% 
  {{PomaOutliers(do = "clean")}}
```

Output:

A clean `MSnSet` object

]

---

# POMA workflow: 3) EDA

.center[
.textboxorange[Include several flexible visualization options such as boxplots, density plots, heatmaps, etc.]
]

### Boxplot examples:

.pull-left[

Display samples:

```{r, echo = FALSE, cache = TRUE, warning = FALSE, comment = FALSE, message = FALSE}
clean_object <- st000336 %>% 
  PomaImpute(method = "knn") %>%
  PomaNorm(method = "log_pareto")
```

```{r, cache = TRUE, warning = FALSE, comment = FALSE, message = FALSE, fig.height = 4}
clean_object %>%
  PomaBoxplots(group = "samples",
               label_size = 5)
```

]

.pull-right[

Display features:

```{r, cache = TRUE, warning = FALSE, comment = FALSE, message = FALSE, fig.height = 4}
clean_object %>%
  PomaBoxplots(group = "features")
```

]

---

# POMA workflow: 3) EDA

### Boxplot examples:

Display features of interest:

```{r, cache = TRUE, warning = FALSE, comment = FALSE, message = FALSE, fig.height = 4, fig.align = "center"}
clean_object %>%
  PomaBoxplots(group = "features",
               feature_name = c("isoleucine", "leucine", "lysine")) #<<
```

---

# POMA workflow: 4) Statistical analysis

All type of analysis

---

# POMA workflow: 4) Statistical analysis

## bla bla

---

# POMA workflow: 4) Statistical analysis

## Predictive features

---

# Next steps...



